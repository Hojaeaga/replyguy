import { NextResponse } from "next/server";

export const dynamic = "force-dynamic"; // ensure it's not cached if needed

export async function GET() {
  const res = await fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/api/app/get-subscriber-count`);
  const data = await res.json();
  const subCount = data.result.data ?? 0;

  const svg = `
<svg width="762" height="600" viewBox="0 0 762 600" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect width="761.538" height="600" fill="white"/>
<path d="M69.7097 434.154V414.666L46.7217 371.717H62.993L76.3318 402.368H76.8994L90.1435 371.717H106.226L83.4269 414.571V434.154H69.7097ZM129.234 435.478C124.252 435.478 119.869 434.501 116.085 432.546C112.301 430.527 109.337 427.595 107.192 423.748C105.048 419.838 103.976 414.981 103.976 409.179C103.976 403.377 105.048 398.552 107.192 394.705C109.4 390.858 112.395 387.989 116.18 386.097C120.027 384.141 124.378 383.164 129.234 383.164C134.217 383.164 138.6 384.141 142.384 386.097C146.231 388.052 149.227 390.984 151.371 394.894C153.578 398.742 154.682 403.566 154.682 409.368C154.682 415.234 153.547 420.121 151.277 424.032C149.069 427.879 146.042 430.748 142.195 432.64C138.411 434.532 134.091 435.478 129.234 435.478ZM129.707 425.356C132.167 425.356 134.217 424.788 135.857 423.653C137.559 422.518 138.821 420.815 139.641 418.545C140.524 416.211 140.965 413.405 140.965 410.125C140.965 406.656 140.492 403.724 139.546 401.327C138.663 398.868 137.339 397.007 135.573 395.746C133.807 394.421 131.568 393.759 128.856 393.759C126.523 393.759 124.504 394.327 122.802 395.462C121.099 396.534 119.806 398.237 118.923 400.57C118.04 402.841 117.599 405.647 117.599 408.99C117.599 414.351 118.671 418.419 120.815 421.194C122.959 423.968 125.923 425.356 129.707 425.356ZM181.206 435.478C175.404 435.478 171.021 433.523 168.056 429.613C165.155 425.64 163.705 419.617 163.705 411.544V384.488H177.327V409.841C177.327 414.698 178.053 418.324 179.503 420.721C180.954 423.054 183.161 424.221 186.125 424.221C187.891 424.221 189.436 423.779 190.761 422.896C192.085 422.013 193.22 420.784 194.166 419.207C195.112 417.63 195.806 415.77 196.247 413.625C196.752 411.481 197.036 409.179 197.099 406.72V384.488H210.721V413.909V434.154H199.748L199.653 418.639H197.95C197.004 422.549 195.806 425.766 194.355 428.289C192.968 430.748 191.171 432.577 188.963 433.775C186.819 434.911 184.233 435.478 181.206 435.478ZM223.215 434.154V410.125V384.488H234.473L234.568 401.422H236.365C236.87 397.196 237.721 393.759 238.919 391.11C240.181 388.462 241.915 386.506 244.122 385.245C246.33 383.984 249.073 383.353 252.353 383.353C252.92 383.353 253.519 383.385 254.15 383.448C254.844 383.448 255.632 383.542 256.515 383.732L255.947 398.205C255.001 397.764 253.961 397.449 252.826 397.259C251.69 397.07 250.681 396.976 249.798 396.976C247.339 396.976 245.226 397.543 243.46 398.678C241.694 399.814 240.244 401.453 239.108 403.598C238.036 405.679 237.311 408.233 236.933 411.26V434.154H223.215ZM264.896 434.154V371.717H290.249C293.655 371.717 296.745 372.001 299.52 372.569C302.295 373.073 304.755 373.83 306.899 374.839C309.043 375.848 310.841 377.109 312.291 378.623C313.805 380.074 314.94 381.776 315.697 383.732C316.454 385.624 316.832 387.736 316.832 390.07C316.832 392.277 316.485 394.295 315.791 396.124C315.098 397.89 314.057 399.435 312.67 400.76C311.282 402.084 309.548 403.188 307.467 404.071C305.385 404.891 302.957 405.458 300.182 405.774V407.193C303.399 407.508 305.953 408.265 307.845 409.463C309.8 410.598 311.314 412.143 312.386 414.098C313.521 416.054 314.499 418.482 315.318 421.383L319.102 434.154H304.061L301.128 422.329C300.561 419.806 299.741 417.851 298.669 416.463C297.597 415.013 296.241 414.004 294.601 413.436C292.961 412.806 290.974 412.49 288.641 412.49H278.519V434.154H264.896ZM278.519 402.273H289.303C293.592 402.273 296.903 401.453 299.236 399.814C301.57 398.174 302.737 395.62 302.737 392.151C302.737 388.745 301.633 386.254 299.425 384.678C297.281 383.038 294.033 382.218 289.682 382.218H278.519V402.273ZM351.431 435.478C347.332 435.478 343.674 434.911 340.457 433.775C337.304 432.64 334.623 431.001 332.416 428.856C330.209 426.712 328.506 424.063 327.308 420.91C326.172 417.756 325.605 414.193 325.605 410.22C325.605 406.31 326.141 402.715 327.213 399.435C328.348 396.093 329.988 393.223 332.132 390.827C334.277 388.367 336.894 386.475 339.984 385.151C343.074 383.826 346.575 383.164 350.485 383.164C354.269 383.164 357.643 383.795 360.607 385.056C363.571 386.254 366.031 388.083 367.986 390.543C370.004 393.002 371.455 396.03 372.338 399.624C373.284 403.156 373.631 407.224 373.378 411.828L334.403 412.206V404.733L365.526 404.449L360.702 408.233C361.143 404.891 360.923 402.147 360.04 400.003C359.157 397.859 357.864 396.282 356.161 395.273C354.521 394.264 352.692 393.759 350.674 393.759C348.278 393.759 346.165 394.39 344.336 395.651C342.507 396.913 341.088 398.773 340.079 401.233C339.07 403.629 338.565 406.53 338.565 409.936C338.565 415.297 339.732 419.238 342.065 421.761C344.462 424.284 347.584 425.545 351.431 425.545C353.197 425.545 354.679 425.324 355.877 424.883C357.139 424.378 358.148 423.748 358.904 422.991C359.724 422.234 360.355 421.383 360.796 420.437C361.301 419.491 361.711 418.545 362.026 417.599L373.851 420.153C373.284 422.486 372.432 424.599 371.297 426.491C370.225 428.32 368.774 429.928 366.945 431.316C365.117 432.64 362.909 433.649 360.323 434.343C357.801 435.1 354.837 435.478 351.431 435.478ZM383.317 450.047V409.747V384.488H394.574L394.669 398.3L396.372 398.395C396.939 395.052 397.917 392.246 399.304 389.975C400.755 387.705 402.615 386.002 404.886 384.867C407.156 383.732 409.773 383.164 412.738 383.164C417.152 383.164 420.936 384.268 424.09 386.475C427.243 388.619 429.64 391.678 431.279 395.651C432.982 399.561 433.834 404.197 433.834 409.558C433.834 414.54 433.077 418.986 431.563 422.896C430.05 426.743 427.779 429.802 424.752 432.073C421.788 434.343 418.067 435.478 413.589 435.478C410.436 435.478 407.755 434.879 405.548 433.681C403.404 432.483 401.606 430.811 400.156 428.667C398.768 426.46 397.601 423.842 396.655 420.815H394.858C395.236 422.518 395.583 424.252 395.899 426.018C396.214 427.784 396.466 429.518 396.655 431.221C396.845 432.861 396.939 434.469 396.939 436.046V450.047H383.317ZM408.859 424.599C411.129 424.599 413.053 423.968 414.63 422.707C416.206 421.446 417.405 419.68 418.224 417.409C419.107 415.139 419.549 412.553 419.549 409.652C419.549 406.499 419.107 403.818 418.224 401.611C417.341 399.341 416.08 397.575 414.44 396.313C412.801 395.052 410.846 394.421 408.575 394.421C406.557 394.421 404.823 394.863 403.372 395.746C401.922 396.629 400.692 397.796 399.683 399.246C398.737 400.697 398.043 402.273 397.601 403.976C397.16 405.616 396.939 407.193 396.939 408.706V410.504C396.939 411.702 397.097 412.963 397.412 414.288C397.728 415.549 398.232 416.81 398.926 418.072C399.62 419.27 400.439 420.374 401.385 421.383C402.331 422.329 403.435 423.117 404.696 423.748C405.958 424.315 407.345 424.599 408.859 424.599ZM443.643 434.154V366.514H457.077V434.154H443.643ZM488.152 451.371C485.629 451.371 483.043 451.119 480.394 450.614C477.809 450.173 475.349 449.448 473.015 448.439C470.745 447.493 468.79 446.263 467.15 444.749L471.029 433.113C473.047 435.194 475.57 436.74 478.597 437.749C481.624 438.821 484.62 439.357 487.584 439.357C490.927 439.357 493.702 438.663 495.909 437.276C498.179 435.951 499.882 433.902 501.017 431.127C502.216 428.289 502.909 424.757 503.099 420.531L503.666 411.923H501.585C500.954 416.085 499.914 419.491 498.463 422.14C497.076 424.788 495.278 426.743 493.071 428.005C490.927 429.203 488.372 429.802 485.408 429.802C481.813 429.802 478.786 428.888 476.326 427.059C473.867 425.23 472.006 422.486 470.745 418.828C469.547 415.171 468.948 410.661 468.948 405.301V384.488H482.57V401.99C482.57 407.855 483.232 412.08 484.557 414.666C485.881 417.252 487.899 418.545 490.611 418.545C492.062 418.545 493.386 418.166 494.584 417.409C495.783 416.59 496.792 415.423 497.612 413.909C498.495 412.396 499.157 410.567 499.598 408.422C500.103 406.215 500.355 403.724 500.355 400.949V384.488H513.978V421.004C513.978 424.978 513.631 428.604 512.937 431.883C512.243 435.1 511.203 437.906 509.815 440.303C508.491 442.763 506.788 444.812 504.707 446.452C502.626 448.092 500.197 449.322 497.423 450.141C494.711 450.961 491.62 451.371 488.152 451.371ZM551.588 435.478C546.479 435.478 541.875 434.312 537.776 431.978C533.739 429.581 530.523 426.05 528.126 421.383C525.793 416.653 524.626 410.724 524.626 403.598C524.626 398.363 525.288 393.728 526.613 389.691C528 385.592 529.987 382.123 532.573 379.285C535.222 376.384 538.469 374.177 542.317 372.663C546.164 371.15 550.61 370.393 555.655 370.393C559.439 370.393 562.877 370.834 565.967 371.717C569.057 372.6 571.738 373.861 574.008 375.501C576.278 377.141 578.044 379.128 579.306 381.461C580.63 383.732 581.355 386.317 581.481 389.218L568.616 393.192C568.49 390.543 567.796 388.367 566.534 386.664C565.336 384.961 563.728 383.7 561.71 382.88C559.755 381.997 557.547 381.556 555.088 381.556C551.682 381.556 548.749 382.344 546.29 383.921C543.893 385.434 542.064 387.799 540.803 391.016C539.542 394.169 538.911 398.174 538.911 403.03C538.911 406.751 539.258 409.968 539.952 412.679C540.708 415.328 541.812 417.536 543.263 419.302C544.713 421.067 546.448 422.392 548.466 423.275C550.484 424.095 552.817 424.505 555.466 424.505C558.241 424.505 560.638 424.063 562.656 423.18C564.737 422.234 566.377 420.815 567.575 418.923C568.836 416.968 569.53 414.508 569.656 411.544H557.831V401.706H583.09V413.152V434.154H573.63L573.819 418.166H572.116C571.107 421.95 569.751 425.135 568.048 427.721C566.345 430.244 564.138 432.167 561.426 433.492C558.777 434.816 555.498 435.478 551.588 435.478ZM611.253 435.478C605.451 435.478 601.067 433.523 598.103 429.613C595.202 425.64 593.752 419.617 593.752 411.544V384.488H607.374V409.841C607.374 414.698 608.099 418.324 609.55 420.721C611 423.054 613.208 424.221 616.172 424.221C617.938 424.221 619.483 423.779 620.807 422.896C622.132 422.013 623.267 420.784 624.213 419.207C625.159 417.63 625.853 415.77 626.294 413.625C626.799 411.481 627.083 409.179 627.146 406.72V384.488H640.768V413.909V434.154H629.795L629.7 418.639H627.997C627.051 422.549 625.853 425.766 624.402 428.289C623.015 430.748 621.217 432.577 619.01 433.775C616.866 434.911 614.28 435.478 611.253 435.478ZM671.811 451.371C669.288 451.371 666.702 451.119 664.053 450.614C661.468 450.173 659.008 449.448 656.675 448.439C654.404 447.493 652.449 446.263 650.809 444.749L654.688 433.113C656.706 435.194 659.229 436.74 662.256 437.749C665.283 438.821 668.279 439.357 671.243 439.357C674.586 439.357 677.361 438.663 679.568 437.276C681.838 435.951 683.541 433.902 684.676 431.127C685.875 428.289 686.568 424.757 686.758 420.531L687.325 411.923H685.244C684.613 416.085 683.573 419.491 682.122 422.14C680.735 424.788 678.937 426.743 676.73 428.005C674.586 429.203 672.031 429.802 669.067 429.802C665.472 429.802 662.445 428.888 659.986 427.059C657.526 425.23 655.665 422.486 654.404 418.828C653.206 415.171 652.607 410.661 652.607 405.301V384.488H666.229V401.99C666.229 407.855 666.891 412.08 668.216 414.666C669.54 417.252 671.558 418.545 674.27 418.545C675.721 418.545 677.045 418.166 678.244 417.409C679.442 416.59 680.451 415.423 681.271 413.909C682.154 412.396 682.816 410.567 683.257 408.422C683.762 406.215 684.014 403.724 684.014 400.949V384.488H697.637V421.004C697.637 424.978 697.29 428.604 696.596 431.883C695.902 435.1 694.862 437.906 693.474 440.303C692.15 442.763 690.447 444.812 688.366 446.452C686.285 448.092 683.857 449.322 681.082 450.141C678.37 450.961 675.279 451.371 671.811 451.371Z" fill="black"/>
<path d="M376.948 139.989C483.802 139.989 525.507 208.323 520.326 254.27L520.195 255.351C514.232 301.281 461.188 340.781 379.701 340.781C339.023 340.781 303.779 331.028 278 315.446C252.609 300.098 236.52 279.185 233.214 256.44L233.066 255.355C228.566 219.962 244.139 191.2 271.042 171.207C297.991 151.18 336.29 139.989 376.948 139.989Z" fill="white" stroke="black" stroke-width="3.0543"/>
<path d="M491.431 242.308C491.431 300 447.504 319.231 377.255 319.231C310.06 319.231 245.277 300 265.239 218.175C279.892 180.769 314.108 165.385 377.255 165.385C440.402 165.385 491.431 191.088 491.431 242.308Z" fill="black"/>
<path d="M337.794 226.247C343.779 226.141 349.548 228.619 356.319 233.422L357.687 234.413L357.864 234.557C358.706 235.323 358.847 236.617 358.156 237.552C357.465 238.486 356.186 238.729 355.208 238.148L355.017 238.021L353.71 237.074C347.283 232.517 342.47 230.655 337.873 230.737C332.923 230.825 327.743 233.168 320.583 238.069C319.56 238.769 318.163 238.507 317.463 237.484C316.764 236.461 317.026 235.065 318.048 234.365C325.35 229.367 331.458 226.36 337.794 226.247Z" fill="white"/>
<path d="M419.724 226.247C425.708 226.141 431.477 228.619 438.249 233.422L439.616 234.413L439.794 234.557C440.636 235.323 440.777 236.617 440.085 237.552C439.394 238.486 438.116 238.729 437.137 238.148L436.947 238.021L435.64 237.074C429.212 232.517 424.4 230.655 419.803 230.737C414.853 230.825 409.672 233.168 402.512 238.069C401.489 238.769 400.093 238.507 399.393 237.484C398.693 236.461 398.955 235.065 399.978 234.365C407.279 229.367 413.387 226.36 419.724 226.247Z" fill="white"/>
<path d="M363.253 273.77C363.253 276.402 361.119 278.536 358.488 278.536C355.856 278.536 353.722 276.402 353.722 273.77C353.722 271.138 355.856 269.004 358.488 269.004C361.119 269.004 363.253 271.138 363.253 273.77Z" fill="white"/>
<path d="M382.319 273.77C382.319 276.402 380.185 278.536 377.553 278.536C374.921 278.536 372.788 276.402 372.788 273.77C372.788 271.138 374.921 269.004 377.553 269.004C380.185 269.004 382.319 271.138 382.319 273.77Z" fill="white"/>
<path d="M401.379 273.77C401.379 276.402 399.245 278.536 396.614 278.536C393.982 278.536 391.848 276.402 391.848 273.77C391.848 271.138 393.982 269.004 396.614 269.004C399.245 269.004 401.379 271.138 401.379 273.77Z" fill="white"/>
<text x="100" y="20" text-anchor="end" font-family="Arial, sans-serif" font-size="20" fill="#000000">
  ${subCount} users 
</text>
</svg>
  `.trim();

  return new NextResponse(svg, {
    status: 200,
    headers: {
      "Content-Type": "image/svg+xml",
      "Cache-Control": "no-cache",
    },
  });
}
